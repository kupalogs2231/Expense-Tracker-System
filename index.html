<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expense Tracker</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f6f8fa;
      color: #333;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      max-width: 450px;
      width: 100%;
      padding: 30px;
    }

    h1 {
      text-align: center;
      color: #007bff;
      margin-bottom: 20px;
    }

    form {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    input, select, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    button {
      background-color: #007bff;
      color: white;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }

    button:hover {
      background-color: #0056b3;
    }

    .transactions {
      margin-top: 20px;
    }

    .transaction {
      background: #f1f1f1;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
    }

    .transaction.expense {
      border-left: 5px solid #e74c3c;
    }

    .transaction.income {
      border-left: 5px solid #2ecc71;
    }

    .balance {
      font-size: 1.2em;
      font-weight: bold;
      text-align: center;
      margin-bottom: 10px;
    }

    .auth-container {
      text-align: center;
    }

    .logout-btn {
      background-color: #dc3545;
    }

    .logout-btn:hover {
      background-color: #b52b3b;
    }

    .small {
      font-size: 0.9em;
      color: #007bff;
      cursor: pointer;
    }

    .small:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Expense Tracker</h1>

    <!-- Login/Register Form -->
    <div id="auth-section" class="auth-container">
      <div id="login-form">
        <h3>Login</h3>
        <input type="text" id="login-username" placeholder="Username" />
        <input type="password" id="login-password" placeholder="Password" />
        <button id="login-btn">Login</button>
        <p>Don't have an account? <span id="show-register" class="small">Register here</span></p>
      </div>

      <div id="register-form" style="display:none;">
        <h3>Register</h3>
        <input type="text" id="register-username" placeholder="Username" />
        <input type="password" id="register-password" placeholder="Password" />
        <button id="register-btn">Register</button>
        <p>Already have an account? <span id="show-login" class="small">Login here</span></p>
      </div>
    </div>

    <!-- Main Tracker Section -->
    <div id="tracker-section" style="display:none;">
      <div class="balance" id="balance">Balance: ₱0.00</div>

      <form id="transaction-form">
        <label for="type">Type</label>
        <select id="type">
          <option value="income">Income</option>
          <option value="expense">Expense</option>
        </select>

        <label for="description">Description</label>
        <input type="text" id="description" placeholder="e.g., Groceries, Salary" required />

        <label for="amount">Amount</label>
        <input type="number" id="amount" placeholder="Enter amount" required />

        <button type="submit">Add Transaction</button>
      </form>

      <div class="transactions" id="transactions"></div>

      <button class="logout-btn" id="logout-btn">Logout</button>
    </div>
  </div>

  <script>
    // ✅ Local Storage Wrapper
    const storage = {
      async get(key) {
        const value = localStorage.getItem(key);
        return value ? { key, value } : null;
      },
      async set(key, value) {
        localStorage.setItem(key, value);
        return { key, value };
      },
      async delete(key) {
        localStorage.removeItem(key);
        return { key, deleted: true };
      }
    };

    // DOM elements
    const authSection = document.getElementById('auth-section');
    const trackerSection = document.getElementById('tracker-section');
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const loginBtn = document.getElementById('login-btn');
    const registerBtn = document.getElementById('register-btn');
    const showRegister = document.getElementById('show-register');
    const showLogin = document.getElementById('show-login');
    const transactionForm = document.getElementById('transaction-form');
    const transactionsDiv = document.getElementById('transactions');
    const balanceDiv = document.getElementById('balance');
    const logoutBtn = document.getElementById('logout-btn');

    let currentUser = null;
    let transactions = [];

    // Toggle forms
    showRegister.addEventListener('click', () => {
      loginForm.style.display = 'none';
      registerForm.style.display = 'block';
    });
    showLogin.addEventListener('click', () => {
      registerForm.style.display = 'none';
      loginForm.style.display = 'block';
    });

    // Register
    registerBtn.addEventListener('click', async () => {
      const username = document.getElementById('register-username').value.trim();
      const password = document.getElementById('register-password').value.trim();

      if (!username || !password) return alert('Please fill all fields.');

      const exists = await storage.get(`user_${username}`);
      if (exists) return alert('Username already exists.');

      await storage.set(`user_${username}`, JSON.stringify({ password, transactions: [] }));
      alert('Registration successful! Please log in.');
      showLogin.click();
    });

    // Login
    loginBtn.addEventListener('click', async () => {
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value.trim();

      const userData = await storage.get(`user_${username}`);
      if (!userData) return alert('User not found.');

      const user = JSON.parse(userData.value);
      if (user.password !== password) return alert('Incorrect password.');

      currentUser = username;
      transactions = user.transactions || [];

      authSection.style.display = 'none';
      trackerSection.style.display = 'block';
      updateUI();
    });

    // Add Transaction
    transactionForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const type = document.getElementById('type').value;
      const description = document.getElementById('description').value.trim();
      const amount = parseFloat(document.getElementById('amount').value);

      if (!description || isNaN(amount)) return alert('Please enter valid data.');

      const transaction = { type, description, amount };
      transactions.push(transaction);

      const userData = JSON.parse((await storage.get(`user_${currentUser}`)).value);
      userData.transactions = transactions;
      await storage.set(`user_${currentUser}`, JSON.stringify(userData));

      transactionForm.reset();
      updateUI();
    });

    // Logout
    logoutBtn.addEventListener('click', async () => {
      currentUser = null;
      transactions = [];
      authSection.style.display = 'block';
      trackerSection.style.display = 'none';
    });

    // Update UI
    function updateUI() {
      transactionsDiv.innerHTML = '';
      let balance = 0;

      transactions.forEach((t) => {
        const div = document.createElement('div');
        div.classList.add('transaction', t.type);
        div.innerHTML = `
          <span>${t.description}</span>
          <span>${t.type === 'income' ? '+' : '-'}₱${t.amount.toFixed(2)}</span>
        `;
        transactionsDiv.appendChild(div);

        balance += t.type === 'income' ? t.amount : -t.amount;
      });

      balanceDiv.textContent = `Balance: ₱${balance.toFixed(2)}`;
    }
  </script>
</body>
</html>
